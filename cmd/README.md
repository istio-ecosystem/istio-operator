## Quick tour of CLI commands
#### Basic default manifest

The following command generates a manifest with the compiled in default profile and charts:

```bash
mesh manifest generate
```

You can see these sources for the compiled in profiles in the repo under `data/profiles`, while the compiled in Helm
charts are under `data/charts`. Note: this will change shortly. Charts/profiles will be released separately and the
by default the mesh command will point to a version of the released charts.

#### Output to dirs

The output of the manifest is concatenated into a single file. To generate a directory hierarchy with subdirectory
levels representing a child dependency, use the following command:

```bash
mesh manifest generate -o istio_manifests
```

Use depth first search to traverse the created directory hierarchy when applying your YAML files. This is needed for
correct sequencing of dependencies. Child manifest directories must wait for their parent directory to be fully applied,
but not their sibling manifest directories.

#### Just apply it for me

The following command generates the manifests and applies them in the correct dependency order, waiting for the
dependencies to have the needed CRDs available:

```bash
mesh manifest apply
```

#### Review the values of a configuration profile

The following commands show the values of a configuration profile:

```bash
# show available profiles
mesh profile list

# show the values in demo profile
mesh profile dump demo

# show the values after a customization file is applied
mesh profile dump -f samples/policy-off.yaml

# show differences between the default and demo profiles
mesh profile dump default > 1.yaml
mesh profile dump demo > 2.yaml
mesh profile diff 1.yaml 2.yaml

# show the differences in the generated manifests between the default profile and a customized install
mesh manifest generate > 1.yaml
mesh manifest generate -f samples/pilot-k8s.yaml > 2.yaml
mesh manifest diff 1.yam1 2.yaml

```

The profile dump sub-command supports a couple of useful flags:

- `config-path`: select the root for the configuration subtree you want to see e.g. just show Pilot:

```bash
mesh profile dump --config-path trafficManagement.components.pilot
```

- `set`: set a value in the configuration before dumping the resulting profile e.g. show the minimal profile:

```bash
mesh profile dump --set profile=minimal
```


#### Select a specific configuration profile

The simplest customization is to select a profile different to `default` e.g. `sds`. See [samples/sds.yaml](samples/sds.yaml):

```yaml
# sds-install.yaml
apiVersion: install.istio.io/v1alpha2
kind: IstioControlPlane
spec:
  profile: sds
```

Use the Istio operator `mesh` binary to apply the new configuration profile:

```bash
mesh manifest generate -f samples/sds.yaml
```

After running the command, the Helm charts are rendered using `data/profiles/sds.yaml`.

#### Install from file path

The compiled in charts and profiles are used by default, but you can specify a file path, for example:

```yaml
apiVersion: install.istio.io/v1alpha2
kind: IstioControlPlane
spec:
  profile: /usr/home/bob/go/src/github.com/ostromart/istio-installer/data/profiles/default.yaml
  installPackagePath: /usr/home/bob/go/src/github.com/ostromart/istio-installer/data/charts/
```

You can mix and match these approaches. For example, you can use a compiled-in configuration profile with charts in your
local file system.

#### Migration from values.yaml
The following command takes helm value.yaml files and output the new IstioControlPlaneSpec, e.g.
```bash
mesh manifest migrate /usr/home/bob/go/src/istio.io/installer/istio-control/istio-discovery/values.yaml
```

or apply to whole directory, e.g.
```bash
mesh manifest migrate /usr/home/bob/go/src/istio.io/installer/istio-control
```

or just take in cluster configs as input if no files specified
```bash
mesh manifest migrate
```

#### Check diffs of manifests
The following command takes two manifests and output the difference in a readable way. It can be used to compare between the manifests generated by operator API and helm directly, e.g.
```bash
mesh manifest diff ./out/helm-template/manifest.yaml ./out/mesh-manifest/manifest.yaml
```